# Gateway / Supervisor - plantilla de variables de entorno
# Copiar a .env y ajustar valores. Se carga al ejecutar: node dist/supervisor.js, node dist/mcp-server.js, npm start

# Nombre del proyecto (aparece en count_docs, search_docs, analize_code). Opcional.
# KNOWLEDGE_HUB_NAME=BlueIvory Beta

# OpenAI (o API compatible): búsqueda semántica (embeddings). Si OPENAI_API_KEY está definido, se usan embeddings.
# La primera vez que lo actives, borra la colección mcp_docs en Qdrant y reindexa.
# OPENAI_API_KEY=sk-...
# OPENAI_EMBEDDING_MODEL=text-embedding-3-small
# Opcional: URL base para usar otra API compatible con OpenAI (Azure, LiteLLM, Ollama, etc.). Si no se define, se usa api.openai.com.
# OPENAI_BASE_URL=https://your-endpoint.com/v1

# Qdrant (usa localhost si Qdrant corre en tu máquina)
QDRANT_URL=http://localhost:6333

# Métricas (InfluxDB + Grafana). Si se define INFLUXDB_URL/ORG/BUCKET, el gateway enviará métricas:
# - search_requests (cantidad de búsquedas, latencia, resultados)
# - indexing_events (cantidad de archivos indexados por fuente: inbox/shared/url)
# - indexing_daily (snapshot diario acumulado)
# INFLUXDB_URL=http://localhost:8086
# INFLUXDB_ORG=mcp
# INFLUXDB_BUCKET=mcp_metrics
# INFLUXDB_TOKEN=change-me

# Tres carpetas del proyecto MCP (todas en la raíz del repo):
# 1) INDEX_INBOX: archivos/carpetas que el supervisor indexa y luego borra.
# 2) classic: carpeta del proyecto Classic (se indexa cada ciclo; el indexador usa project=classic).
# 3) blueivory: carpeta del proyecto BlueIvory (se indexa cada ciclo; el indexador usa project=blueivory).
# Rutas relativas (classic, blueivory) se resuelven contra la raíz del proyecto MCP.

# Carpeta inbox (por defecto: raíz del proyecto / INDEX_INBOX)
INDEX_INBOX_DIR=C:/PROYECTOS/MCP-SERVER/INDEX_INBOX
# Nombre de proyecto para lo que indexes desde el inbox. Opcional.
# INDEX_INBOX_PROJECT=inbox

# Carpetas classic y blueivory (rutas relativas a la raíz del proyecto)
SHARED_DIRS=classic:classic;blueivory:blueivory

# Proyectos que se indexan UNA SOLA VEZ; tras el primer ciclo completo no se vuelven a indexar (persistido en SQLite data/one_time_indexed.db).
# En EC2/Docker usa nombres que coincidan con SHARED_DIRS, p. ej. classic;blueivory
# SHARED_DIRS_ONCE=classic;blueivory

# Control de cambios: por defecto solo se indexan archivos NUEVOS (no se reindexa lo ya en Qdrant).
# Para que un archivo ya indexado que cambió se reindexe: se compara hash (SHA-256) del contenido;
# solo se reindexa si activas la opción y el hash actual ≠ hash guardado.
# INDEX_SHARED_REINDEX_CHANGED=true  → reindexa los archivos cuyo contenido cambió (por hash).
# INDEX_SHARED_SYNC_DELETED=true     → borra de Qdrant los documentos cuyo archivo ya no existe en disco.
# No definidas o false = no reindexar por cambios, no borrar por borrado en disco.

# Branch por proyecto. Por defecto se usan alias: classic/clasic/core → classic; bi/BI/blueivory/blue-ivory/bi-* → blueivory. Para otros nombres:
# BRANCH_PROJECTS=classic:classic-core,core;blueivory:blueivory-main,bi-main

# Domain por path (accounting, shipments, warehouse, etc.). Opcional: "domain:keyword1,keyword2;...". Si path o project contiene keyword → domain.
# DOMAIN_KEYWORDS=accounting:accounting,account;shipments:shipment,shipping;warehouse:warehouse,wr,receipt

# Estadísticas de indexación por día (archivos indexados: inbox, shared, url). Por defecto: gateway/data/indexing_stats.db
# INDEX_STATS_DB=/ruta/indexing_stats.db

# Proyecto por defecto para URLs indexadas (index_url / index_site). Permite filtrar después por project en search_docs.
# INDEX_URL_DEFAULT_PROJECT=urls

# Supervisor: revisa inbox + SHARED_DIRS cada 2 min. URLs solo bajo demanda (MCP index_url / index_site)
SUPERVISOR_INTERVAL_MS=120000
POLL_INTERVAL_MS=120000
RESTART_DELAY_MS=10000

# Opcional: login para URLs que piden autenticación (herramientas index_url / index_site)
# INDEX_URL_USER=
# INDEX_URL_PASSWORD=

# Límite al usar herramienta MCP index_site
INDEX_SITE_MAX_PAGES=1000

# GitHub: opcional. Para search_github_repos aumenta el límite de peticiones (30/min con token vs 10/min sin).
# GITHUB_TOKEN=ghp_...

# view_url: tamaño máximo del documento (bytes). Por defecto 10 MB; máximo 50 MB. 0 = 50 MB.
# VIEW_URL_MAX_LENGTH=10485760

# Sesiones MCP HTTP (streamable). Por defecto 3; si Cursor no conecta por "Maximum sessions per user reached", sube el valor (p. ej. 10) y reinicia el gateway.
# MAX_SESSIONS_PER_USER=10

# API key de larga duración: en mcp.json usa Authorization: Bearer <MCP_API_KEY> y no tendrás que refrescar cada hora.
# MCP_API_KEY=<64 chars hex o similar>
# MCP_API_KEY_USER_ID=<sub del usuario, opcional; mismo que Cognito test = mismo límite de sesiones>

# Logs MCP (diagnóstico de requests pegados en búsqueda). Por defecto: logs/mcp.log (relativo al cwd). Ver gateway/docs/LOGS-MCP-BUSQUEDA.md.
# MCP_LOG_PATH=logs/mcp.log

# Umbral (ms) para log "mcp POST slow". Si getOrCreateSessionMs o handleRequestMs superan este valor, se registra como slow. Por defecto 500.
# MCP_SLOW_MS=500

# ClickUp (herramientas MCP: listar workspaces/listas/tareas, crear y actualizar tareas). Local e instancia.
# Personal API Token: ClickUp → Settings → Apps → API Token (pk_...).
# CLICKUP_API_TOKEN=pk_...
# Opcional para seed-clickup-tasks.cjs: lista destino y usuario asignado. Si no se definen, se descubren automáticamente.
# LIST_ID=901325668563
# ASSIGNEE_USER_ID=12345
# Opcional para clickup-tasks-to-finished.cjs: nombre del tag a aplicar (debe existir en el workspace). Por defecto: entregable
# CLICKUP_TAG=entregable
# Supervisor de bugs (scripts/supervisor-bugs.cjs): usa CLICKUP_API_TOKEN y OPENAI_API_KEY. Opcional: OPENAI_CHAT_MODEL=gpt-4o-mini, OPENAI_CHAT_TIMEOUT_MS=60000

# Azure DevOps (herramientas MCP: listar work items, ver changesets TFVC, diff de archivos). Local e instancia.
# PAT: Azure DevOps → User settings → Personal access tokens (Work Items Read, Code Read).
# AZURE_DEVOPS_BASE_URL=https://devops.magaya.com/tfs/DevelopmentCollection
# AZURE_DEVOPS_PROJECT=Magaya Core Project
# AZURE_DEVOPS_PAT=<tu Personal Access Token>
# Opcional: api-version de la API (por defecto 7.0).
# AZURE_DEVOPS_API_VERSION=7.0
# Rutas TFVC para filtro por proyecto (azure_count_changesets, azure_list_changesets, etc.). Si no se definen, se usan rutas por defecto (BLUE-IVORY-MAIN, CORE).
# AZURE_DEVOPS_TFVC_PATH_BLUEIVORY=$/Magaya Core Project/Projects/MAIN-BRANCHES/BLUE-IVORY-MAIN
# AZURE_DEVOPS_TFVC_PATH_CORE=$/Magaya Core Project/Projects/MAIN-BRANCHES/CORE
# Field ref names for azure_bug_analysis_or_solution (defaults: Custom.PossibleCause, Custom.SolutionDescription)
# AZURE_DEVOPS_FIELD_ANALYSIS=Custom.PossibleCause
# AZURE_DEVOPS_FIELD_SOLUTION=Custom.SolutionDescription
